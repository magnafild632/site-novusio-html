# üöÄ Sistema de Deploy Autom√°tico - Novusio

Este sistema fornece um deploy completo e automatizado para VPS, incluindo todas as configura√ß√µes necess√°rias para produ√ß√£o.

## üìã Pr√©-requisitos

- **VPS Ubuntu/Debian** (Ubuntu 20.04+ ou Debian 11+)
- **Acesso root** ao servidor
- **Dom√≠nio configurado** apontando para o IP do servidor
- **Reposit√≥rio Git** com o c√≥digo da aplica√ß√£o

## üîß Instala√ß√£o R√°pida

### 1. Conectar ao servidor

```bash
ssh root@seu-servidor.com
```

### 2. Baixar o script de deploy

```bash
# Op√ß√£o 1: Clonar o reposit√≥rio
git clone https://github.com/seu-usuario/site-novusio-html.git
cd site-novusio-html/instalador

# Op√ß√£o 2: Baixar diretamente
wget https://raw.githubusercontent.com/seu-usuario/site-novusio-html/main/instalador/deploy.sh
chmod +x deploy.sh
```

### 3. Executar o deploy

```bash
# Menu interativo completo
sudo ./deploy.sh

# Deploy r√°pido (sem menu)
sudo ./quick-deploy.sh

# Comandos r√°pidos
sudo ./novusio-cli.sh help
```

## üìã Menu Interativo

O script principal agora inclui um menu interativo com as seguintes op√ß√µes:

### üöÄ Menu Principal

1. **Deploy Completo** - Nova instala√ß√£o completa
2. **Atualizar Aplica√ß√£o** - Update do c√≥digo e depend√™ncias
3. **Remover Projeto** - Deletar completamente o projeto
4. **Status do Sistema** - Verificar status e recursos
5. **Manuten√ß√£o R√°pida** - Limpeza e otimiza√ß√£o
6. **Logs e Monitoramento** - Visualizar logs
7. **Sair** - Sair do script

O script ir√° solicitar as seguintes informa√ß√µes:

- **Dom√≠nio** (ex: novusio.com)
- **Email** para SSL (Let's Encrypt)
- **Usu√°rio** do sistema (ex: novusio)
- **Porta** da aplica√ß√£o (padr√£o: 3000)
- **Diret√≥rio** do projeto (padr√£o: /opt/novusio)
- **Reposit√≥rio Git** da aplica√ß√£o

## üõ†Ô∏è O que √© instalado

### Pacotes do Sistema

- **Node.js 18.x** - Runtime JavaScript
- **Nginx** - Servidor web e proxy reverso
- **PM2** - Gerenciador de processos Node.js
- **Certbot** - Certificados SSL autom√°ticos
- **UFW** - Firewall
- **Fail2ban** - Prote√ß√£o contra ataques
- **Git** - Controle de vers√£o

### Configura√ß√µes Autom√°ticas

- ‚úÖ **SSL/TLS** com Let's Encrypt
- ‚úÖ **Firewall** configurado (portas 22, 80, 443)
- ‚úÖ **Nginx** com proxy reverso
- ‚úÖ **PM2** com clustering e restart autom√°tico
- ‚úÖ **Backup autom√°tico** di√°rio
- ‚úÖ **Monitoramento** a cada 5 minutos
- ‚úÖ **Rate limiting** e prote√ß√£o contra ataques
- ‚úÖ **Headers de seguran√ßa**
- ‚úÖ **Compress√£o Gzip**
- ‚úÖ **Cache de arquivos est√°ticos**

## üìÅ Estrutura de Arquivos

```
instalador/
‚îú‚îÄ‚îÄ deploy.sh                    # Script principal com menu interativo
‚îú‚îÄ‚îÄ quick-deploy.sh              # Deploy r√°pido sem menu
‚îú‚îÄ‚îÄ novusio-cli.sh               # CLI para comandos r√°pidos
‚îú‚îÄ‚îÄ ecosystem.config.js          # Configura√ß√£o PM2
‚îú‚îÄ‚îÄ nginx.conf                   # Configura√ß√£o Nginx
‚îú‚îÄ‚îÄ env.production.template      # Template de vari√°veis de ambiente
‚îú‚îÄ‚îÄ backup.sh                    # Script de backup autom√°tico
‚îú‚îÄ‚îÄ monitor.sh                   # Script de monitoramento
‚îú‚îÄ‚îÄ systemd.service              # Servi√ßo systemd
‚îú‚îÄ‚îÄ fail2ban.conf                # Configura√ß√£o Fail2ban
‚îú‚îÄ‚îÄ fail2ban-filters.conf        # Filtros personalizados
‚îî‚îÄ‚îÄ README-DEPLOY.md             # Este arquivo
```

### üÜï Novas Funcionalidades

#### Menu Interativo

- ‚úÖ **Deploy Completo** - Instala√ß√£o nova com todas as configura√ß√µes
- ‚úÖ **Atualizar Aplica√ß√£o** - Update do c√≥digo sem reinstalar tudo
- ‚úÖ **Remover Projeto** - Deletar completamente (com confirma√ß√£o)
- ‚úÖ **Status do Sistema** - Monitoramento em tempo real
- ‚úÖ **Manuten√ß√£o R√°pida** - Limpeza e otimiza√ß√£o autom√°tica
- ‚úÖ **Logs e Monitoramento** - Visualiza√ß√£o de logs centralizada

#### CLI R√°pido

- ‚úÖ **Comandos diretos** - Execute a√ß√µes sem menu
- ‚úÖ **Automa√ß√£o** - Ideal para scripts e cron jobs
- ‚úÖ **Feedback visual** - Cores e status em tempo real

#### Seguran√ßa Autom√°tica

- ‚úÖ **Gera√ß√£o autom√°tica de JWT_SECRET** - 48 bytes seguros
- ‚úÖ **Gera√ß√£o autom√°tica de SESSION_SECRET** - 32 bytes seguros
- ‚úÖ **Backup dos secrets** - Arquivo seguro para refer√™ncia
- ‚úÖ **Regenera√ß√£o de secrets** - Script dedicado quando necess√°rio

## üîê Configura√ß√µes de Seguran√ßa

### Firewall (UFW)

- **SSH (22)** - Acesso administrativo
- **HTTP (80)** - Redirecionamento para HTTPS
- **HTTPS (443)** - Tr√°fego seguro
- **Porta da aplica√ß√£o** - Se diferente de 80/443

### Fail2ban

- **SSH** - Prote√ß√£o contra for√ßa bruta
- **Nginx** - Prote√ß√£o contra ataques web
- **API** - Rate limiting e prote√ß√£o
- **Admin** - Prote√ß√£o do painel administrativo

### SSL/TLS

- **Let's Encrypt** - Certificados gratuitos
- **Renova√ß√£o autom√°tica** - Via cron
- **HSTS** - HTTP Strict Transport Security
- **Headers de seguran√ßa** - CSP, X-Frame-Options, etc.

## üìä Monitoramento

### Scripts Autom√°ticos

- **backup.sh** - Backup di√°rio √†s 2h
- **monitor.sh** - Monitoramento a cada 5 minutos

### Verifica√ß√µes

- ‚úÖ Status da aplica√ß√£o PM2
- ‚úÖ Uso de mem√≥ria e CPU
- ‚úÖ Espa√ßo em disco
- ‚úÖ Conectividade da aplica√ß√£o
- ‚úÖ Certificado SSL
- ‚úÖ Logs de erro
- ‚úÖ Status dos servi√ßos

### Logs

- `/var/log/novusio/` - Logs da aplica√ß√£o
- `/var/log/nginx/` - Logs do Nginx
- `/var/log/novusio-backup.log` - Logs de backup
- `/var/log/novusio-monitor.log` - Logs de monitoramento

## üéõÔ∏è Comandos √öteis

### CLI R√°pido (Novusio CLI)

```bash
# Comandos b√°sicos
sudo ./novusio-cli.sh start      # Iniciar aplica√ß√£o
sudo ./novusio-cli.sh stop       # Parar aplica√ß√£o
sudo ./novusio-cli.sh restart    # Reiniciar aplica√ß√£o
sudo ./novusio-cli.sh status     # Status da aplica√ß√£o
sudo ./novusio-cli.sh logs       # Ver logs
sudo ./novusio-cli.sh update     # Atualizar aplica√ß√£o
sudo ./novusio-cli.sh backup     # Backup manual
sudo ./novusio-cli.sh monitor    # Executar monitoramento
sudo ./novusio-cli.sh ssl        # Renovar SSL
sudo ./novusio-cli.sh nginx      # Recarregar Nginx
sudo ./novusio-cli.sh maintenance # Manuten√ß√£o r√°pida
sudo ./novusio-cli.sh info       # Informa√ß√µes do sistema
sudo ./novusio-cli.sh menu       # Abrir menu interativo
sudo ./novusio-cli.sh help       # Ajuda
```

### Gerenciamento Manual da Aplica√ß√£o

```bash
# Status da aplica√ß√£o
sudo -u novusio pm2 status

# Logs da aplica√ß√£o
sudo -u novusio pm2 logs

# Reiniciar aplica√ß√£o
sudo -u novusio pm2 restart novusio-server

# Parar aplica√ß√£o
sudo -u novusio pm2 stop novusio-server

# Iniciar aplica√ß√£o
sudo -u novusio pm2 start novusio-server
```

### Gerenciamento do Nginx

```bash
# Testar configura√ß√£o
nginx -t

# Recarregar configura√ß√£o
systemctl reload nginx

# Status do Nginx
systemctl status nginx

# Logs do Nginx
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

### SSL e Certificados

```bash
# Renovar certificado
certbot renew

# Status dos certificados
certbot certificates

# Testar renova√ß√£o
certbot renew --dry-run
```

### Secrets de Seguran√ßa

```bash
# Regenerar JWT_SECRET e SESSION_SECRET
sudo /opt/novusio/instalador/regenerate-secrets.sh

# Ou usando o script do instalador
cd /opt/novusio/instalador
sudo ./regenerate-secrets.sh

# Ver secrets atuais (apenas para debug)
grep -E "JWT_SECRET|SESSION_SECRET" /opt/novusio/.env

# Ver backup de secrets
ls -la /opt/novusio/.secrets-*
```

### Backup e Monitoramento

```bash
# Executar backup manual
/usr/local/bin/novusio-backup.sh

# Executar monitoramento manual
/usr/local/bin/novusio-monitor.sh

# Ver logs de backup
tail -f /var/log/novusio-backup.log

# Ver logs de monitoramento
tail -f /var/log/novusio-monitor.log
```

## üîß Configura√ß√µes Avan√ßadas

### Vari√°veis de Ambiente

Edite o arquivo `.env` em `/opt/novusio/`:

```bash
nano /opt/novusio/.env
```

### Configura√ß√£o do Nginx

Edite a configura√ß√£o do Nginx:

```bash
nano /etc/nginx/sites-available/novusio
```

### Configura√ß√£o do PM2

Edite a configura√ß√£o do PM2:

```bash
nano /opt/novusio/ecosystem.config.js
```

## üö® Troubleshooting

### Aplica√ß√£o n√£o inicia

```bash
# Verificar logs
sudo -u novusio pm2 logs

# Verificar configura√ß√£o
nginx -t

# Verificar portas
netstat -tlnp | grep :3000
```

### SSL n√£o funciona

```bash
# Verificar certificado
certbot certificates

# Testar renova√ß√£o
certbot renew --dry-run

# Verificar Nginx
nginx -t
```

### Backup n√£o funciona

```bash
# Verificar permiss√µes
ls -la /opt/backups/novusio

# Executar backup manual
/usr/local/bin/novusio-backup.sh

# Verificar logs
tail -f /var/log/novusio-backup.log
```

## üìû Suporte

### Logs Importantes

- `/var/log/novusio/error.log` - Erros da aplica√ß√£o
- `/var/log/nginx/error.log` - Erros do Nginx
- `/var/log/novusio-monitor.log` - Monitoramento
- `/var/log/novusio-backup.log` - Backup

### Comandos de Diagn√≥stico

```bash
# Status geral do sistema
systemctl status nginx fail2ban

# Status da aplica√ß√£o
sudo -u novusio pm2 status

# Uso de recursos
htop
df -h
free -h

# Conectividade
curl -I https://seu-dominio.com
```

## üîÑ Atualiza√ß√µes

### Atualizar a aplica√ß√£o

```bash
cd /opt/novusio
git pull origin main
npm ci
npm run build
sudo -u novusio pm2 restart novusio-server
```

### Atualizar o sistema

```bash
apt update && apt upgrade -y
```

## üìù Notas Importantes

1. **Altere a senha padr√£o** do admin imediatamente ap√≥s o deploy
2. **Configure backup regular** dos dados importantes
3. **Monitore os logs** regularmente
4. **Mantenha o sistema atualizado** com patches de seguran√ßa
5. **Configure notifica√ß√µes** para alertas importantes
6. **Teste o backup** periodicamente

## üéØ Pr√≥ximos Passos

Ap√≥s o deploy:

1. ‚úÖ Acesse `https://seu-dominio.com/admin`
2. ‚úÖ Fa√ßa login com as credenciais padr√£o
3. ‚úÖ Configure as informa√ß√µes da empresa
4. ‚úÖ Altere a senha do admin
5. ‚úÖ Configure backup e monitoramento
6. ‚úÖ Teste todas as funcionalidades

---

**üéâ Deploy conclu√≠do com sucesso!** Seu site Novusio est√° online e pronto para uso.
