# =============================================================================
# FILTROS FAIL2BAN PARA NOVUSIO
# =============================================================================
# Este arquivo contém os filtros personalizados para detectar ataques
# específicos contra a aplicação Novusio
# =============================================================================

# Filtro para API Abuse
[INCLUDES]
before = common.conf

[Definition]
failregex = ^<HOST> -.*"(GET|POST|PUT|DELETE) /api/.*" (4\d{2}|5\d{2}) .*$
            ^<HOST> -.*"(GET|POST|PUT|DELETE) /api/.*" 429 .*$
            ^<HOST> -.*"POST /api/auth/login" 401 .*$
            ^<HOST> -.*"POST /api/auth/login" 429 .*$

ignoreregex = ^<HOST> -.*"GET /api/health" 200 .*$
              ^<HOST> -.*"GET /api/status" 200 .*$

# Filtro para Admin Login Abuse
[INCLUDES]
before = common.conf

[Definition]
failregex = ^<HOST> -.*"POST /api/auth/login" 401 .*$
            ^<HOST> -.*"POST /api/auth/login" 429 .*$
            ^<HOST> -.*"POST /admin/login" 401 .*$
            ^<HOST> -.*"POST /admin/login" 429 .*$

ignoreregex = ^<HOST> -.*"POST /api/auth/login" 200 .*$

# Filtro para SQL Injection
[INCLUDES]
before = common.conf

[Definition]
failregex = ^<HOST> -.*".*".*"(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|EXEC|UNION|SCRIPT).*" .*$
            ^<HOST> -.*".*".*".*(;|--|\/\*|\*\/).*" .*$
            ^<HOST> -.*".*".*".*(\bOR\b|\bAND\b).*=.*" .*$
            ^<HOST> -.*".*".*".*(\bOR\b|\bAND\b).*\b1\b.*=.*\b1\b.*" .*$

ignoreregex = 

# Filtro para XSS
[INCLUDES]
before = common.conf

[Definition]
failregex = ^<HOST> -.*".*".*".*<script.*>.*" .*$
            ^<HOST> -.*".*".*".*javascript:.*" .*$
            ^<HOST> -.*".*".*".*on\w+\s*=.*" .*$
            ^<HOST> -.*".*".*".*<iframe.*>.*" .*$
            ^<HOST> -.*".*".*".*<object.*>.*" .*$
            ^<HOST> -.*".*".*".*<embed.*>.*" .*$

ignoreregex = 

# Filtro para Directory Traversal
[INCLUDES]
before = common.conf

[Definition]
failregex = ^<HOST> -.*".*".*".*\.\.\/.*" .*$
            ^<HOST> -.*".*".*".*\.\.\\\.\..*" .*$
            ^<HOST> -.*".*".*".*%2e%2e%2f.*" .*$
            ^<HOST> -.*".*".*".*%2e%2e%5c.*" .*$
            ^<HOST> -.*".*".*".*\.\.%2f.*" .*$
            ^<HOST> -.*".*".*".*\.\.%5c.*" .*$

ignoreregex = 

# Filtro para Nginx Bot Search
[INCLUDES]
before = common.conf

[Definition]
failregex = ^<HOST> -.*"(GET|POST|HEAD).*" (4\d{2}|5\d{2}) .*$
            ^<HOST> -.*"(GET|POST|HEAD).*" 429 .*$
            ^<HOST> -.*"(GET|POST|HEAD).*" 444 .*$

ignoreregex = ^<HOST> -.*"(GET|POST|HEAD).*" 200 .*$
              ^<HOST> -.*"(GET|POST|HEAD).*" 301 .*$
              ^<HOST> -.*"(GET|POST|HEAD).*" 302 .*$
              ^<HOST> -.*"(GET|POST|HEAD).*" 304 .*$
              ^<HOST> -.*"(GET|POST|HEAD).*" 403 .*$
              ^<HOST> -.*"(GET|POST|HEAD).*" 404 .*$

# Filtro para Nginx Limit Req
[INCLUDES]
before = common.conf

[Definition]
failregex = limiting requests, excess: .* by zone .*, client: <HOST>

ignoreregex = 

# Filtro para Nginx HTTP Auth
[INCLUDES]
before = common.conf

[Definition]
failregex = ^\[error\] \d+#\d+: \*\d+ no user/password was provided for basic authentication, client: <HOST>, server: .*, request: ".*", host: ".*"$
            ^\[error\] \d+#\d+: \*\d+ user ".*": password mismatch, client: <HOST>, server: .*, request: ".*", host: ".*"$

ignoreregex = 

# Filtro para PHP Injection (caso use PHP no futuro)
[INCLUDES]
before = common.conf

[Definition]
failregex = ^<HOST> -.*".*".*".*(\bphp\b|\bphpinfo\b|\bphpmyadmin\b).*" .*$
            ^<HOST> -.*".*".*".*\.php\?.*" .*$
            ^<HOST> -.*".*".*".*\.php\b.*" .*$

ignoreregex = ^<HOST> -.*".*".*".*\.php" 200 .*$

# Filtro para Wordpress (caso use WP no futuro)
[INCLUDES]
before = common.conf

[Definition]
failregex = ^<HOST> -.*".*".*".*\/wp-.*" .*$
            ^<HOST> -.*".*".*".*\/wp-admin.*" .*$
            ^<HOST> -.*".*".*".*\/wp-login.*" .*$

ignoreregex = ^<HOST> -.*".*".*".*\/wp-content.*" 200 .*$
              ^<HOST> -.*".*".*".*\/wp-includes.*" 200 .*$

# Filtro para Common Attacks
[INCLUDES]
before = common.conf

[Definition]
failregex = ^<HOST> -.*".*".*".*(\badmin\b|\badministrator\b|\broot\b|\buser\b).*" .*$
            ^<HOST> -.*".*".*".*(\btest\b|\btesting\b|\bdebug\b).*" .*$
            ^<HOST> -.*".*".*".*(\bconfig\b|\bsetup\b|\binstall\b).*" .*$
            ^<HOST> -.*".*".*".*(\bbackup\b|\bdump\b|\bexport\b).*" .*$

ignoreregex = ^<HOST> -.*".*".*".*\/admin" 200 .*$
              ^<HOST> -.*".*".*".*\/api\/admin" 200 .*$
